<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jeu en JavaScript</title>
    <style>
        body, html {
            margin: 0;
            padding: 0;
            overflow: hidden;
        }
        canvas {
            display: block;
            margin: 0 auto;
            background: url('background.png') no-repeat center center;
            background-size: cover;
        }
    </style>
</head>
<body>
    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Définir le rapport d'aspect souhaité, ici 16:9
        const aspectRatio = 16 / 9;
        let gameWidth, gameHeight;

        // Fonction pour redimensionner le canvas tout en conservant le ratio d'aspect
        function resizeCanvas() {
            const windowRatio = window.innerWidth / window.innerHeight;

            if (windowRatio > aspectRatio) {
                // Fenêtre plus large que l'aspect ratio => ajuster la largeur
                gameHeight = window.innerHeight;
                gameWidth = gameHeight * aspectRatio;
            } else {
                // Fenêtre plus haute que l'aspect ratio => ajuster la hauteur
                gameWidth = window.innerWidth;
                gameHeight = gameWidth / aspectRatio;
            }

            canvas.width = gameWidth;
            canvas.height = gameHeight;
        }

        window.addEventListener('resize', resizeCanvas);
        resizeCanvas(); // Initial resize

        // Chargement des images
        const playerImage = new Image();
        playerImage.src = 'player.png';

        const goodItemImage = new Image();
        goodItemImage.src = 'good_item.png';

        const badItemImage = new Image();
        badItemImage.src = 'bad_item.png';

        const worseItemImage = new Image();
        worseItemImage.src = 'worse_item.png';

        const imagesLoaded = new Promise((resolve) => {
            let images = [playerImage, goodItemImage, badItemImage, worseItemImage];
            let loadedCount = 0;
            images.forEach(image => {
                image.onload = () => {
                    loadedCount++;
                    if (loadedCount === images.length) {
                        resolve();
                    }
                };
            });
        });

        // Variables du jeu
        let playerSize = 50;
        let playerPos = { x: gameWidth / 2, y: gameHeight - playerSize };
        let items = [];
        let itemSize = 50;
        let fallSpeed = 10;
        let score = 0;
        let maxItems = 40;
        let specialItemAdded = false;
        let gameDuration = 60000; // 1 minute
        let startTime = Date.now();

        // Fonction de génération des items
        function dropItems(timeLeft) {
            if (timeLeft > 2) {
                if (items.length < maxItems && Math.random() < 0.1) {
                    let draw = Math.random() * 100;
                    let itemImage, points;
                    if (draw <= 10) {
                        itemImage = worseItemImage;
                        points = -3;
                    } else if (draw <= 25) {
                        itemImage = badItemImage;
                        points = -1;
                    } else {
                        itemImage = goodItemImage;
                        points = 1;
                    }
                    let itemPos = { x: Math.random() * (gameWidth - itemSize), y: 0, image: itemImage, points: points };
                    items.push(itemPos);
                }
            } else if (timeLeft === 2 && !specialItemAdded) {
                let itemPos = { x: Math.random() * (gameWidth - itemSize), y: 0, image: goodItemImage, points: 5 };
                items.push(itemPos);
                specialItemAdded = true;
            }
        }

        // Dessin des items
        function drawItems() {
            items.forEach(item => {
                ctx.drawImage(item.image, item.x, item.y, itemSize, itemSize);
            });
        }

        // Mise à jour des positions des items
        function updateItemPositions() {
            items = items.filter(item => item.y <= gameHeight);
            items.forEach(item => {
                item.y += fallSpeed;
            });
        }

        // Gestion des collisions
        function collisionCheck() {
            let playerRect = { x: playerPos.x, y: playerPos.y, width: playerSize, height: playerSize };
            for (let i = items.length - 1; i >= 0; i--) {
                let item = items[i];
                let itemRect = { x: item.x, y: item.y, width: itemSize, height: itemSize };
                if (playerRect.x < itemRect.x + itemRect.width &&
                    playerRect.x + playerRect.width > itemRect.x &&
                    playerRect.y < itemRect.y + itemRect.height &&
                    playerRect.height + playerRect.y > itemRect.y) {
                    score += item.points;
                    items.splice(i, 1);
                }
            }
        }

        // Boucle principale du jeu
        function gameLoop() {
            let currentTime = Date.now();
            let timeLeft = Math.floor((gameDuration - (currentTime - startTime)) / 1000);

            if (timeLeft <= 0) {
                ctx.clearRect(0, 0, gameWidth, gameHeight);
                displayLeaderboard();
                return;
            }

            ctx.clearRect(0, 0, gameWidth, gameHeight);

            dropItems(timeLeft);
            updateItemPositions();
            collisionCheck();
            drawItems();

            // Dessin du joueur
            ctx.drawImage(playerImage, playerPos.x, playerPos.y, playerSize, playerSize);

            // Affichage du score et du temps restant
            ctx.font = '35px monospace';
            ctx.fillStyle = '#000';
            ctx.fillText(`Score: ${score}`, 20, 40);
            ctx.fillText(`Time: ${timeLeft}s`, gameWidth - 150, 40);

            requestAnimationFrame(gameLoop);
        }

        // Gestion des événements de la souris
        canvas.addEventListener('mousemove', (e) => {
            const rect = canvas.getBoundingClientRect();
            playerPos.x = (e.clientX - rect.left) * (gameWidth / rect.width) - playerSize / 2;
        });

        // Démarrage du jeu après chargement des images
        imagesLoaded.then(() => {
            startTime = Date.now(); // Réinitialiser le temps de départ
            gameLoop();
        });
    </script>
</body>
</html>
